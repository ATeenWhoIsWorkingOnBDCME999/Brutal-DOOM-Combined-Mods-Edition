

ACTOR LightningGunShockMode : Inventory
{
Inventory.MaxAmount 1
}

// --------------------------------------------------------------------------
//
// Lightning Gun
//
// --------------------------------------------------------------------------

ACTOR LightningGun : CMEWeapon
{
	Game Doom
    Weapon.BobRangeX 0.3
	Weapon.BobRangeY 0.5
	Weapon.BobStyle InverseSmooth
	Weapon.BobSpeed 2.0
	Weapon.SelectionOrder 90
    Weapon.AmmoUse 1
    Weapon.AmmoGive 100
    Weapon.AmmoType "Cell2"
  //  Weapon.SlotNumber 7
	DamageType Plasma
	Inventory.PickupSound "electrogun/pickup"
    +WEAPON.NOAUTOAIM
	-FORCEXYBILLBOARD
	+WEAPON.AXEBLOOD
	+WEAPON.NO_AUTO_SWITCH
	+FLOORCLIP
	+DONTGIB
    Inventory.PickupMessage "You got the Lightning Gun! (Slot 7)"
    Obituary "%o was electrocuted by %k."
    Tag "Lightning Gun"
    States
	{
	Steady:
	TNT1 A 1
	Goto Ready
	
	Ready:
	    TNT1 A 0
		TNT1 A 0 A_PlaySound("electrogun/select")
        LTGR FEDCBA 1 A_JumpIfInventory("GoFatality", 1, "Steady")
       TNT1 A 0 A_JumpIfInventory("Kicking",1,"DoKick")
		TNT1 A 0 A_JumpIfInventory("GoFatality", 1, "Steady")
		TNT1 A 0 A_JumpIfInventory("DoPunch",1,"QuickPunch")
        TNT1 A 0 A_JumpIfInventory("Taunting",1,"Taunt")
		TNT1 A 0 A_JumpIfInventory("Salute1", 1, "Salute")
		TNT1 A 0 A_JumpIfInventory("Salute2", 1, "Salute")
        TNT1 A 0 A_JumpIfInventory("Reloading",1,"Reload")
		TNT1 A 0 A_JumpIfInventory("Unloading",1,"Unload")
		TNT1 A 0 A_JumpIfInventory("TossGrenade",1,"TossGrenade")
		TNT1 A 0 A_JumpIfInventory("DoMine", 1, "ThrowMine")
		TNT1 A 0 A_JumpIfInventory("DoElecPod", 1, "ThrowElecPod")
		TNT1 A 0 A_JumpIfInventory("DoSwarmPod", 1, "ThrowSwarmPod")
		TNT1 A 0 A_JumpIfInventory("GrabbedBarrel", 1, "GrabBarrel")
		TNT1 A 0 A_JumpIfInventory("GoWeaponSpecialAbility", 1, "SwitchtoShockwave")
		TNT1 A 0 A_JumpIfInventory("ThrowPipeBomb",1,"ThrowPipeBomb")
		TNT1 A 0 A_JumpIfInventory("DetonatePipeBomb",1,"DetonatePipeBomb")//
		TNT1 A 0 A_JumpIfInventory("GoEmergencyGunAbility", 1, "FireEmergency")
		TNT1 A 0 A_JumpIfInventory("GoSwitchAmmo", 1, "SwitchEmergency")
		TNT1 A 0 A_PlaySound("electrogun/hum", 5, 1, 1)
		LTGG A 1 A_WeaponReady
		TNT1 A 0 A_StopSound(7)
        Goto Ready+8
		
	Deselect:
		TNT1 A 0 A_StopSound(5)
		TNT1 A 0 A_StopSound(7)
        LTGR ABCDEF 1
		TNT1 A 0 A_TakeInventory("TossGrenade", 1)
		TNT1 A 0 A_TakeInventory("GoWeaponSpecialAbility", 1)
		TNT1 A 0 A_Lower
		Wait
		
	Select:
		TNT1 A 0 A_Takeinventory("HasUnloaded",1)
		TNT1 A 0 A_Takeinventory("Unloading",1)
		TNT1 A 0 A_Takeinventory("FistsSelected",1)
		TNT1 A 0 A_Takeinventory("SawSelected",1)
		TNT1 A 0 A_Takeinventory("ShotgunSelected",1)
		TNT1 A 0 A_Takeinventory("SSGSelected",1)
		TNT1 A 0 A_Takeinventory("MinigunSelected",1)
		TNT1 A 0 A_Takeinventory("PlasmaGunSelected",1)
		TNT1 A 0 A_Takeinventory("RocketLauncherSelected",1)
		TNT1 A 0 A_Takeinventory("GrenadeLauncherSelected",1)
		TNT1 A 0 A_Takeinventory("BFGSelected",1)
		TNT1 A 0 A_Takeinventory("BFG10kSelected",1)
		TNT1 A 0 A_Takeinventory("RailGunSelected",1)
		TNT1 A 0 A_Takeinventory("SubMachineGunSelected",1)
		TNT1 A 0 A_Takeinventory("RevenantLauncherSelected",1)
		TNT1 A 0 A_Takeinventory("LostSoulSelected",1)
		TNT1 A 0 A_Takeinventory("FlameCannonSelected",1)
		TNT1 A 0 A_Takeinventory("HasBarrel",1)
		TNT1 A 0 A_TakeInventory("TossGrenade", 1)
		TNT1 A 0 A_TakeInventory("LandMineSelected",1)
		TNT1 A 0 A_TakeInventory("HasBurningBarrel",1)
		TNT1 A 0 A_Takeinventory("HasCutingWeapon",1)
		TNT1 AAAAAAAAAAAA 0 A_Raise
		LTGG A 0 A_Raise
		Wait
		
	SwitchFireMode:
		TNT1 A 0 A_TakeInventory("LightningGunShockMode", 1)
		TNT1 A 0 A_PlaySound("DSBOWREL", 2, 3)
		TNT1 A 0 A_Print("Firemode: Cluster")
		Goto Ready+10
		
	SwitchtoShockwave:
		TNT1 A 0 A_Takeinventory("GoWeaponSpecialAbility",1)
		TNT1 A 0 A_JumpIfInventory("LightningGunShockMode",1,"SwitchFireMode")
		TNT1 A 0 A_GiveInventory("LightningGunShockMode", 1)
		TNT1 A 0 A_PlaySound("DSBOWREL", 2, 3)
		TNT1 A 0 A_Print("Firemode: Shockwave")
		Goto Ready+10
		
	WeaponSpecial:
		TNT1 A 0 A_Takeinventory("GoWeaponSpecialAbility",1)
		TNT1 A 0 A_JumpIfInventory("Cell2", 30, 1)
		Goto Ready+10
		TNT1 A 0 A_PlayWeaponSound("electrogun/charge2")
		LTGG AAAAAAAA 3 BRIGHT
		LTGF IJAB 2 BRIGHT
		LTGG A 0 A_PlaySound("electrogun/bomb", 1)
		LTGG A 0 A_TakeInventory("Cell2", 30)
		LTGF A 0 A_SetBlend("Blue", 0.4, 35)
		LTGF C 5 A_FireCustomMissile("BlueStormShot",0,0,0,0)
		LTGF DEFGH 3 BRIGHT
		Goto Ready+8
	
	Fire:
	  //LTGG AAAAAAA 3 A_PlayWeaponSound("electrogun/charge")
		LTGG A 0 A_PlaySound("electrogun/fire", 1, 1)
		LTGG A 0 A_PlaySound("electrogun/loop", 7, 1, 1)
    Hold:
	 // LTGG A 0 A_GunFlash 
		LTGG A 0 A_TakeInventory("Cell2", 1)
		LTGF I 1 BRIGHT A_RailAttack(20, 0, 0, "blue", "red", RGF_SILENT | RGF_NOPIERCING | RGF_FULLBRIGHT, 0, "none", 0, 0, 1024, 0, random(20, 25), 1, "LightningGunProjectile", -1)
		LTGF J 1  BRIGHT A_RailAttack(20, 0, 0, "blue", "red", RGF_SILENT | RGF_NOPIERCING | RGF_FULLBRIGHT, 0, "none", 0, 0, 1024, 0, random(20, 25), 1, "LightningGunProjectile", -1)
		LTGG AAAAAAA 0 A_ReFire
	 //	LTGG AAAAAAAA 2
		Goto Ready+10
		
	AltFire:
		TNT1 A 0 A_JumpIfInventory("Cell2", 50, 1)
		Goto Ready+10
		TNT1 A 0 A_JumpIfInventory("LightningGunShockMode", 1, "ShockwaveFire")
		Goto ClusterFire
		
	ShockwaveFire:
		TNT1 A 0 A_PlayWeaponSound("electrogun/charge2")
		LTGG AAAAAAAA 3
		LTGF IJAB 2
		LTGG A 0 A_PlaySound("electrogun/bomb", 1)
		LTGG A 0 A_TakeInventory("Cell2", 50)
		LTGF A 0 A_SetBlend("Blue", 0.4, 35)
		LTGF C 5 A_FireCustomMissile("ElectroBomb",0,0,0,0)
		LTGF DEFGH 3 
		Goto Ready+10
		
	ClusterFire:
		TNT1 A 0 A_PlayWeaponSound("electrogun/charge2")
		LTGG AAAAAAAA 3 BRIGHT
		LTGF IJAB 2 BRIGHT
		LTGG A 0 BRIGHT A_PlaySound("electrogun/bomb", 1)
		LTGG A 0 BRIGHT A_TakeInventory("Cell2", 50)
		LTGF A 0 BRIGHT A_SetBlend("Blue", 0.4, 35)
		LTGF C 5 BRIGHT A_FireCustomMissile("ElectroBombCluster",0,0,0,0)
		LTGF DEFGH 3 BRIGHT
		Goto Ready+10
		
	Spawn:
		LTGN A -1
		Stop
	}
}

Actor LightningGunProjectile: FastProjectile
{
	+RANDOMIZE
	+FORCEXYBILLBOARD
	+DONTSPLASH
	-BLOODSPLATTER
	+FORCERADIUSDMG
	damage 0
	radius 1
	height 1
	speed 500
  Mass 9999999
	renderstyle ADD
	//alpha 0.9
	scale .15
	decal "none"
	damagetype "Plasma"
	missiletype "LightningGunProjectile"
	states
		{
		Spawn:
			TNT1 A 1 BRIGHT
			Loop
			
		Death:
			TNT1 A 0 BRIGHT A_SpawnItem("LightningGunPuff",0)
			TNT1 A 0 BRIGHT A_SpawnItem("BlueFlare",0)
			TNT1 AA 0 A_SpawnItemEx("FreezerTrailSparksSmall", random(4,-4), random(4,-4), random(4,-4), 0, 0, 0, 0, 128, 0)
			TNT1 A 0 A_explode(random(12,15), 80)
			TNT1 AAA 0 A_CustomMissile ("BluePlasmaParticle", 0, 0, random (0, 360), 2, random (0, 360))
			TNT1 A 1 Light("LightningImpactLight")
			Stop
		}
	}

Actor LightningGunPuff
{
  -COUNTKILL
  -SHOOTABLE
  +CLIENTSIDEONLY
  +BLOODLESSIMPACT 
  +FORCEXYBILLBOARD
  +THRUACTORS
  +NOGRAVITY
  +NODAMAGETHRUST
  +DONTTHRUST
  +DONTSPLASH
  -SHOOTABLE
  +RANDOMIZE
  Mass 9999999
  RenderStyle Add
  Speed 0
  Radius 1
  Height 1
	damagetype "Plasma"
	Scale 1.12
	States
	{
		Spawn:
			TNT1 A 0
			TNT1 A 0 A_CheckFloor("FloorCheck")
			TNT1 A 1
			Die:
			DB08 ABCDEFGHIJKLM 1 bright A_SetScale(ScaleX+frandom(0.04,0.08), ScaleY+frandom(0.04,0.08))
			DB08 NOPQRSTUVWXYZABCDEFGHIJKLM 1 bright
				{
					A_SetScale(ScaleX-0.08, ScaleY-0.08);
					A_FadeOut(0.08);
				}
			Stop
			
		FloorCheck:
			TNT1 A 0 Acs_executealways(373, 0, 0, 0, 0)//Check if is under a liquid
			TNT1 A 2
			TNT1 A 0 A_JumpIfInventory("IsOverWater", 1, "ConductiveDeath")
			TNT1 A 0 A_JumpIfInventory("IsOverSludge", 1, "ConductiveDeath")
			TNT1 A 0 A_JumpIfInventory("IsOverSlime", 1, "ConductiveDeath")
			TNT1 A 0 A_JumpIfInventory("IsOverBlood", 1, "ConductiveDeath")
			TNT1 A 1
			Goto Die	
			
		ConductiveDeath:
			TNT1 A 0 BRIGHT A_SpawnItem("LightningGunPuff_Big",0)
			TNT1 A 0 BRIGHT A_SpawnItem("ElectroBombFX",0)
			TNT1 A 0 BRIGHT A_SpawnItem("BlueFlare",0)
			TNT1 A 0 A_explode(random(30,35), 240,0,0,200)
			TNT1 AA 0 A_CustomMissile("LightningGunProjectile3",6,0,random(0,359),CMF_AIMDIRECTION|CMF_TRACKOWNER,random(30,270))
			TNT1 AAAAA 0 A_CustomMissile ("BluePlasmaParticle", 0, 0, random (0, 360), 2, random (0, 360))
			TNT1 A 1 Light("LightningImpactLight")
			Stop
	}
}

Actor LightningGunPuff_Big
{
  -COUNTKILL
  -SHOOTABLE
  +CLIENTSIDEONLY
  +BLOODLESSIMPACT 
  +FORCEXYBILLBOARD
  +THRUACTORS
  +NOGRAVITY
  +NODAMAGETHRUST
  +DONTSPLASH
  +RANDOMIZE
	  RenderStyle Add
		Scale 2.50
		States 
		{
		
			Spawn:
				DB08 ABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZ 1 bright 
				{
					A_SetScale(ScaleX-0.1, ScaleY-0.1);
					A_FadeOut(0.03);
				}
				Stop
		
		}
}

Actor LightningGunPuff_Bigger : LightningGunPuff_Big
{Scale 3.25}

actor LightningGunProjectile
{
	+VISIBILITYPULSE
	Radius 0
	Height 0
	+NOGRAVITY
	+NOINTERACTION
	Speed 0
	+RANDOMIZE
	+DontSplash
	+THRUACTORS
	+NOBLOOD
	RenderStyle Add
	//Alpha 0.4
	Scale 0.27
	States
	{
	Spawn:
			TNT1 A 0
			TNT1 A 0 A_Jump (256, "Spawn2", "Spawn3", "Spawn4", "Spawn5", "Spawn6", "Spawn7", "Spawn8", "Spawn9", "Spawn10")
			DLI6 ABCDEFGHIJK 1 bright
			Stop
		Spawn2:
			TNT1 A 0
			DLI7 ABCDEFGHIJK 1 bright
			Stop
		Spawn2:
			TNT1 A 0
			DLI8 ABCDEFGHIJK 1 bright
			Stop
		Spawn3:
			TNT1 A 0
			DLI9 ABCDEFGHIJK 1 bright
			Stop
		Spawn4:
			TNT1 A 0
			DLI0 ABCDEFGHIJK 1 bright
			Stop
		Spawn5:
			TNT1 A 0
			DLI6 ABCDEFGHIJK 1 bright
			Stop
		Spawn6:
			TNT1 A 0
			DLI7 LMNOPQRSTUV 1 bright
			Stop
		Spawn7:
			TNT1 A 0
			DLI8 LMNOPQRSTUV 1 bright
			Stop
		Spawn8:
			TNT1 A 0
			DLI9 LMNOPQRSTUV 1 bright
			Stop
		Spawn9:
			TNT1 A 0
			DLI0 LMNOPQRSTUV 1 bright
			Stop
		Spawn10:
			TNT1 A 0
			DLI0 ABCDEFGHIJK 1 bright
			Stop
	}
}

Actor LightningGunProjectile2 : LightningGunProjectile
{
	Speed 10
}

Actor LightningGunProjectile3 : LightningGunProjectile
{
	Speed 10
	Scale 0.62
}



Actor StunElectrocute : LightningGunProjectile
{
	Scale 0.32
	States
	{
	Spawn:
			TNT1 A 0
			TNT1 A 0 A_Playsound("Sparks/Spawn")
			TNT1 A 0 A_Jump (256, "Spawn2", "Spawn3", "Spawn4", "Spawn5", "Spawn6", "Spawn7", "Spawn8", "Spawn9", "Spawn10")
			DLI6 ABCDEFGHIJK 1 bright Light("ElectrocutionLight")
			Stop
		Spawn2:
			TNT1 A 0
			DLI7 ABCDEFGHIJK 1 bright Light("ElectrocutionLight")
			Stop
		Spawn2:
			TNT1 A 0
			DLI8 ABCDEFGHIJK 1 bright Light("ElectrocutionLight")
			Stop
		Spawn3:
			TNT1 A 0
			DLI9 ABCDEFGHIJK 1 bright Light("ElectrocutionLight")
			Stop
		Spawn4:
			TNT1 A 0
			DLI0 ABCDEFGHIJK 1 bright Light("ElectrocutionLight")
			Stop
		Spawn5:
			TNT1 A 0
			DLI6 ABCDEFGHIJK 1 bright Light("ElectrocutionLight")
			Stop
		Spawn6:
			TNT1 A 0
			DLI7 LMNOPQRSTUV 1 bright Light("ElectrocutionLight")
			Stop
		Spawn7:
			TNT1 A 0
			DLI8 LMNOPQRSTUV 1 bright Light("ElectrocutionLight")
			Stop
		Spawn8:
			TNT1 A 0
			DLI9 LMNOPQRSTUV 1 bright Light("ElectrocutionLight")
			Stop
		Spawn9:
			TNT1 A 0
			DLI0 LMNOPQRSTUV 1 bright Light("ElectrocutionLight")
			Stop
		Spawn10:
			TNT1 A 0
			DLI0 ABCDEFGHIJK 1 bright Light("ElectrocutionLight")
			Stop
	}
}

Actor ElectroBombFX
{
   Speed 0
   Damage 0
   PROJECTILE
   RENDERSTYLE ADD
   Damagetype plasma
   Scale 0.35
   +THRUGHOST
   +THRUACTORS
   +FORCEXYBILLBOARD
   +NoGravity
   +DONTSPLASH
   States
   {
   Spawn:
	  TNT1 A 0
	  TNT1 A 0 A_PlaySound("LGBOMB")
	  STFL ABCDEFGHIJKLMNOP 1 Bright A_SetScale(ScaleX+0.05,ScaleY+0.05)
	  STFL ABCDE 1 BRIGHT A_FadeOut(0.2)
	  Stop
	  }
}

Actor StunBomb
{
   Radius 2
   Height 2
   Speed 24
   Damage 0
  // PROJECTILE
   RENDERSTYLE ADD
   //Alpha 0.80
   Damagetype Stun //New Damage type!
   Scale 0.1
    +MISSILE
   +THRUGHOST
   +FORCEXYBILLBOARD
    Gravity .5
   SeeSound ""
   DeathSound "LGBOMB"
   States
   {
   Spawn:
      TNT1 A 0
      TNT1 A 0 A_PlaySound("PZAPFLY", 6,1,1)
      STFL ABCD 1 A_SetScale(ScaleX+0.02,ScaleY+0.02)
	  Fly:
	  STFL EFGH 1 Bright A_CustomMissile("LightningGunProjectile",6,0,random(0,359),CMF_AIMDIRECTION|CMF_TRACKOWNER,random(-40,40))
	  STFL IJKL 1 Bright Light("LightningImpactLight") A_CustomMissile("LightningGunProjectile",6,0,random(0,359),CMF_AIMDIRECTION|CMF_TRACKOWNER,random(-40,40))
	  STFL MNOP 1 Bright A_CustomMissile("LightningGunProjectile",6,0,random(0,359),CMF_AIMDIRECTION|CMF_TRACKOWNER,random(-40,40))
      STFL ABCD 1 Bright Light("LightningImpactLight") A_CustomMissile("LightningGunProjectile",6,0,random(0,359),CMF_AIMDIRECTION|CMF_TRACKOWNER,random(-40,40))
	  Loop
	  
   Death:
	  TNT1 A 0
	  TNT1 A 0 A_ChangeFlag("NOGRAVITY", 1)
	  TNT1 A 0 A_StopSound(6)
      STFL ABCDEFGHIJKL 1 BRIGHT Light("LightningImpactLight") A_SetScale(ScaleX+0.1,ScaleY+0.1)
	  TNT1 A 0 BRIGHT A_SpawnItem("LightningGunPuff_Bigger",0)
	  TNT1 A 0 BRIGHT A_SpawnItem("BlueFlare",0)
	  TNT1 A 0 A_explode(2, 300,0,0,300)
	  TNT1 A 0 A_PlaySound("STNBOEX", 3)
	  TNT1 AAAAAAAAAAA 0 A_CustomMissile("LightningGunProjectile3",6,0,random(0,359),CMF_AIMDIRECTION|CMF_TRACKOWNER,random(30,270))
	  XELC AABBCCDDEEFF 1 Bright Light("LightningImpactLight") A_CustomMissile("LightningGunProjectile3",6,0,random(0,359),CMF_AIMDIRECTION|CMF_TRACKOWNER,random(30,270))
	  Stop
	  }
}
